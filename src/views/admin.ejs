<%- include('partials/header', {
    title: 'Admin Dashboard',
    showNav: true,
    currentPage: 'admin',
    isAdmin: user.role === 'admin'
  }) %>

  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

  <div class="content-wrapper">

    <div class="header-actions mb-4">
           
        <div class="search-box flex items-center bg-gray-100 p-2 rounded-lg shadow-sm">
          <i class="fas fa-search text-gray-500 mr-2"></i>
          <input type="text" id="searchTerm" placeholder="Rechercher un rapport..." value="<%= searchTerm %>" class="flex-grow bg-transparent outline-none text-gray-700" aria-label="Search reports">
          <button id="clearSearch" class="ml-2 p-1.5 bg-red-500 text-white rounded-full hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-400 h-6 w-6 flex items-center justify-center text-sm" aria-label="Clear search" tabindex="0">Ã—</button>
        </div>
        <script>
            const searchInput = document.getElementById('searchTerm');
            const clearSearchButton = document.getElementById('clearSearch');
            let searchTimeout;

            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    clearTimeout(searchTimeout);
                    const searchValue = searchInput.value.trim();
                    
                    if (searchValue.length === 0) {
                        window.location.href = '/admin';
                        return;
                    }

                    if (searchValue.length >= 2) {
                        searchTimeout = setTimeout(() => {
                            window.location.href = '/admin?searchTerm=' + encodeURIComponent(searchValue);
                        }, 550);
                    }
                });
            }

            if (clearSearchButton) {
                clearSearchButton.addEventListener('click', function() {
                    searchInput.value = '';
                    window.location.href = '/admin';
                });
            }
        </script>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

    <!-- Inspection Reports Card -->
    <div class="bg-white shadow rounded-lg">
      <div class="p-4 border-b">
        <h2 class="text-xl font-semibold">Inspection Reports</h2>
      </div>
      <div class="p-4 overflow-x-auto">
        <% if (inspectionReports && inspectionReports.length > 0) { %>
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Report ID</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Vehicle ID</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mileage</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Next Inspection</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <% inspectionReports.forEach(report => { %>
                <tr>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= report.report_id %></td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= report.vehicle_id %></td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= report.mileage %> km</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= report.next_technical_inspection %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } else { %>
          <p class="text-gray-600">No inspection reports found.</p>
        <% } %>
      </div>
    </div>

    <!-- Users Card -->
    <div class="bg-white shadow rounded-lg">
      <div class="p-4 border-b">
        <h2 class="text-xl font-semibold">Users</h2>
      </div>
      <div class="p-4 overflow-x-auto">
        <% if (users && users.length > 0) { %>
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Username</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <% users.forEach(user => { %>
                <tr>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= user.username %></td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= user.email %></td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= user.role %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } else { %>
          <p class="text-gray-600">No users found.</p>
        <% } %>
      </div>
    </div>

    <!-- Customers Card -->
    <div class="bg-white shadow rounded-lg">
      <div class="p-4 border-b">
        <h2 class="text-xl font-semibold">Customers</h2>
      </div>
      <div class="p-4 overflow-x-auto">
        <% if (customers && customers.length > 0) { %>
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phone</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Company</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <% customers.forEach(customer => { %>
                <tr>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= customer.name %></td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= customer.email %></td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= customer.phone %></td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= customer.is_company ? "Yes" : "No" %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } else { %>
          <p class="text-gray-600">No customers found.</p>
        <% } %>
      </div>
    </div>

    <!-- Vehicles Card -->
    <div class="bg-white shadow rounded-lg">
      <div class="p-4 border-b">
        <h2 class="text-xl font-semibold">Vehicles</h2>
      </div>
      <div class="p-4 overflow-x-auto">
        <% if (vehicles && vehicles.length > 0) { %>
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">License Plate</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Brand</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Model</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Engine Code</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <% vehicles.forEach(vehicle => { %>
                <tr>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= vehicle.license_plate %></td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= vehicle.brand %></td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= vehicle.model %></td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= vehicle.engine_code %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } else { %>
          <p class="text-gray-600">No vehicles found.</p>
        <% } %>
      </div>
    </div>

    <!-- Inspection Items Card -->
    <div class="bg-white shadow rounded-lg md:col-span-2">
      <div class="p-4 border-b">
        <h2 class="text-xl font-semibold">Inspection Items</h2>
      </div>
      <div class="p-4 overflow-x-auto">
        <% if (inspectionItems && inspectionItems.length > 0) { %>
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Active</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Display Order</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <% inspectionItems.forEach(item => { %>
                <tr>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= item.name %></td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= item.type %></td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= item.category %></td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= item.is_active ? "Yes" : "No" %></td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= item.display_order %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } else { %>
          <p class="text-gray-600">No inspection items found.</p>
        <% } %>
      </div>
    </div>

  </div>
</body>
</html>
